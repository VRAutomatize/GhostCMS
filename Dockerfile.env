# Ghost CMS Fork - Usando imagem oficial com variáveis de ambiente
FROM ghost:6.0.8-alpine

# Definir variáveis de ambiente
ENV NODE_ENV=production
ENV url=https://blog.clebersocial.com.br
ENV database__client=mysql2
ENV database__connection__host=cms_ghost-db
ENV database__connection__user=mysql
ENV database__connection__password=91cf92ea3a47f6ced4f7
ENV database__connection__database=cms
ENV mail__from=no-reply@clebersocial.com.br
ENV mail__transport=Direct
ENV logging__level=info
ENV paths__contentPath=/var/lib/ghost/content

# Criar diretório de conteúdo
RUN mkdir -p /var/lib/ghost/content

# Expor porta
EXPOSE 2368

# Health check
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:2368/ghost/ || exit 1

# Comando de inicialização
CMD ["node", "current/index.js", "start", "--no-setup"]
